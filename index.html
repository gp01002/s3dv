<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç«‹é«”ç…§ç‰‡ 3D è§€è³å™¨ - çµ‚æ¥µç‰ˆ</title>
    <style>
        :root { --accent: #ffdd59; --bg: #111; }
        body {
            margin: 0; background: var(--bg); color: white;
            font-family: sans-serif; display: flex; flex-direction: column; align-items: center;
            overflow: hidden;
        }
        
        .viewport {
            position: relative; width: 92vw; max-width: 750px;
            margin-top: 30px; overflow: visible;
            perspective: 1500px;
            perspective-origin: center center;
        }
        
        .photo-container {
            position: relative;
            width: 100%;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 40px 80px rgba(0,0,0,0.9);
            background: #000;
            transition: transform 0.35s cubic-bezier(0.16, 0.84, 0.44, 1),
                        box-shadow 0.35s ease;
            transform-style: preserve-3d;
            will-change: transform;
        }
        
        canvas { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            object-fit: cover;
            transition: transform 0.35s cubic-bezier(0.16, 0.84, 0.44, 1),
                        opacity 0.35s cubic-bezier(0.16, 0.84, 0.44, 1),
                        filter 0.25s ease;
            will-change: transform, opacity;
        }
        
        #canvasL { z-index: 1; }
        #canvasR { z-index: 2; }

        .panel { width: 90%; max-width: 750px; padding: 25px; text-align: center; }
        .thumb-nav { 
            display: flex; gap: 15px; overflow-x: auto; padding: 10px; 
            justify-content: flex-start; scrollbar-width: none;
        }
        .thumb-item {
            flex: 0 0 75px; height: 75px; border-radius: 15px;
            border: 3px solid #333; overflow: hidden; cursor: pointer; transition: 0.3s;
        }
        .thumb-item.active { border-color: var(--accent); transform: scale(1.1); }
        .thumb-item img { width: 100%; height: 100%; object-fit: cover; }

        #authBtn {
            padding: 12px 30px; border-radius: 30px; border: none;
            background: var(--accent); color: #000; font-weight: bold; 
            cursor: pointer; box-shadow: 0 5px 15px rgba(255, 221, 89, 0.4);
        }
        .hint { font-size: 13px; color: #777; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="viewport" id="vbox">
        <div class="photo-container" id="photoContainer">
            <canvas id="canvasL"></canvas>
            <canvas id="canvasR"></canvas>
        </div>
    </div>

    <div class="panel">
        <div class="thumb-nav" id="thumbNav"></div>
        <div style="margin: 20px 0;">
            <button id="authBtn">é–‹å•Ÿé«˜ç´š 3D æ¨¡å¼</button>
        </div>
        <p class="hint">ğŸ“± ç·©æ…¢å·¦å³å‚¾æ–œæ‰‹æ©Ÿ | ğŸ’» æ»‘é¼ åœ¨ç…§ç‰‡ä¸Šè¼•æŸ”æ»‘å‹•</p>
    </div>

    <script>
        const cvL = document.getElementById('canvasL');
        const cvR = document.getElementById('canvasR');
        const ctxL = cvL.getContext('2d');
        const ctxR = cvR.getContext('2d');
        const thumbNav = document.getElementById('thumbNav');
        const authBtn = document.getElementById('authBtn');
        const photoContainer = document.getElementById('photoContainer');
        
        let images = [];
        const filenames = ['photo1.jpg', 'photo2.jpg', 'photo3.jpg', 'photo4.jpg', 'photo5.jpg', 'photo6.jpg'];

        window.onload = () => {
            filenames.forEach((name, i) => {
                const img = new Image();
                img.src = name;
                img.onload = () => {
                    images[i] = img;
                    const div = document.createElement('div');
                    div.className = 'thumb-item' + (i===0?' active':'');
                    div.innerHTML = `<img src="${img.src}">`;
                    div.onclick = () => loadPhoto(i);
                    thumbNav.appendChild(div);
                    if (i === 0) loadPhoto(0);
                };
            });
        };

        function loadPhoto(index) {
            const img = images[index];
            const w = img.width / 2;
            const h = img.height;
            cvL.width = cvR.width = w;
            cvL.height = cvR.height = h;
            photoContainer.style.aspectRatio = `${w}/${h}`;
            ctxL.drawImage(img, 0, 0, w, h, 0, 0, w, h);
            ctxR.drawImage(img, w, 0, w, h, 0, 0, w, h);
            document.querySelectorAll('.thumb-item').forEach((t, i) => t.classList.toggle('active', i === index));
            update3D(0.5, 0.5); 
        }

        // âœ¨ çµ‚æ¥µç®—æ³•ï¼šå¤šå±¤æ¬¡ 3D æ•ˆæœ
        function update3D(percentX, percentY) {
            const centerOffsetX = (percentX - 0.5);
            const centerOffsetY = (percentY - 0.5);
            
            // === ç¬¬ä¸€å±¤ï¼š3D å®¹å™¨æ—‹è½‰ === 
            const maxRotation = 8; // è¼•å¾®æ—‹è½‰ä¸æœƒå¤ªèª‡å¼µ
            const rotateY = centerOffsetX * maxRotation * 2;
            const rotateX = -centerOffsetY * maxRotation * 1.5;
            
            // === ç¬¬äºŒå±¤ï¼šè¦–å·®ä½ç§»ï¼ˆåœ¨æ—‹è½‰çš„åŸºç¤ä¸Šï¼‰===
            const easeOut = (t) => 1 - Math.pow(1 - t, 3);
            const smoothOffsetX = centerOffsetX >= 0 
                ? easeOut(centerOffsetX * 2) * 0.5
                : -easeOut(-centerOffsetX * 2) * 0.5;
            
            const maxShift = 20;
            const shiftL = smoothOffsetX * maxShift * 0.7;
            const shiftR = smoothOffsetX * maxShift * 1.3;
            
            // === ç¬¬ä¸‰å±¤ï¼šå‹•æ…‹ç¸®æ”¾å¢åŠ æ·±åº¦ ===
            const scaleBase = 1.06;
            const scaleDelta = Math.abs(smoothOffsetX) * 0.03;
            const scaleL = scaleBase + scaleDelta * 0.4;
            const scaleR = scaleBase + scaleDelta * 0.6;
            
            // æ‡‰ç”¨è¦–å·®ä½ç§»åˆ° canvas
            cvL.style.transform = `scale(${scaleL}) translateX(${shiftL}px)`;
            cvR.style.transform = `scale(${scaleR}) translateX(${shiftR}px)`;
            
            // === ç¬¬å››å±¤ï¼šS æ›²ç·šé€æ˜åº¦æ··åˆ ===
            const smoothstep = (x) => x * x * (3 - 2 * x);
            const blendFactor = smoothstep(percentX);
            
            cvR.style.opacity = 0.35 + blendFactor * 0.65;
            cvL.style.opacity = 0.35 + (1 - blendFactor) * 0.65;
            
            // === ç¬¬äº”å±¤ï¼šæ™¯æ·±å¾®æ¨¡ç³Š ===
            const blurAmount = Math.abs(centerOffsetX) * 0.4;
            cvL.style.filter = `blur(${blurAmount}px) brightness(${1 - Math.abs(centerOffsetX) * 0.05})`;
            cvR.style.filter = `blur(${blurAmount * 0.3}px) brightness(${1 + Math.abs(centerOffsetX) * 0.05})`;
            
            // === ç¬¬å…­å±¤ï¼šå®¹å™¨ 3D æ—‹è½‰ ===
            photoContainer.style.transform = `
                rotateX(${rotateX}deg) 
                rotateY(${rotateY}deg)
                scale(1.02)
            `;
            
            // === ç¬¬ä¸ƒå±¤ï¼šå‹•æ…‹é™°å½± ===
            const shadowX = rotateY * 2.5;
            const shadowY = -rotateX * 2.5;
            const shadowBlur = 20 + (Math.abs(rotateY) + Math.abs(rotateX)) * 1.5;
            
            photoContainer.style.boxShadow = `
                ${shadowX}px ${shadowY}px ${shadowBlur}px rgba(0,0,0,0.6),
                0 40px 80px rgba(0,0,0,0.9)
            `;
        }

        let targetX = 0.5, targetY = 0.5;
        let currentX = 0.5, currentY = 0.5;
        
        // æ…£æ€§å‹•ç•«
        function animate() {
            const ease = 0.12;
            currentX += (targetX - currentX) * ease;
            currentY += (targetY - currentY) * ease;
            
            if (Math.abs(targetX - currentX) > 0.001 || Math.abs(targetY - currentY) > 0.001) {
                update3D(currentX, currentY);
                requestAnimationFrame(animate);
            }
        }

        document.getElementById('vbox').onmousemove = (e) => {
            const rect = e.currentTarget.getBoundingClientRect();
            targetX = (e.clientX - rect.left) / rect.width;
            targetY = (e.clientY - rect.top) / rect.height;
            requestAnimationFrame(animate);
        };

        document.getElementById('vbox').onmouseleave = () => {
            targetX = targetY = 0.5;
            requestAnimationFrame(animate);
        };

        authBtn.onclick = () => {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(s => {
                    if(s==='granted') {
                        window.addEventListener('deviceorientation', handleMove);
                        authBtn.textContent = 'âœ“ çµ‚æ¥µ 3D æ¨¡å¼å·²å•Ÿå‹•';
                        authBtn.style.background = '#4ade80';
                    }
                });
            } else {
                window.addEventListener('deviceorientation', handleMove);
                authBtn.style.display = 'none';
            }
        };

        function handleMove(e) {
            if(!e.gamma || !e.beta) return;
            targetX = Math.max(0, Math.min(1, (e.gamma + 25) / 50));
            targetY = Math.max(0, Math.min(1, (e.beta + 25) / 50));
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
